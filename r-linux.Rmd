---
title: "Установка R и R-studio на Linux"
output: 
  html_document:
    includes:
       in_header: ga.html
       after_body: gtm.html
---

В данном примере мы рассмотрим установку языка R и R-studio IDE на Ubuntu 16.04

*** 

## Выбор виртуальной машины

В качестве облачного сервиса, предоставляющего услуги по хостингу виртуальных машин мы выберем Google Cloud Platform с сервисом Compute Engine. Это очень удобное решение для тех, кто уже работает с другими сервисами от GCP.

Ранее я уже писал о том, как настроить и запустить VM на Google Cloud Platform через сервис Compute Engine. А сейчас перейдём к следующему шагу

*** 

## Подготовка к установке

Для установки языка R в операционную систему Linux нам необходимо открыть терминал и вводить команды напрямую. Чтобы открыть терминал необходимо нажать на кнопку **SSH**. 

![](images/gcp-ssh.png) 
Терминал откроется в новом окне. После открытия терминала начинаем последовательно вводить команды

### Первичное обновление Linux

Необходимо обновить все пакеты, установленные в версии Ubuntu 16.04

```{r eval=FALSE}
sudo apt-get update
```

Выглядит это примерно так

![](images/apt-update.png)

### Добавление ссылки на репозиторий Cran

Установка будет производиться напрямую из репозитория Cran, поэтому необходимо добавить ссылку в файл **/etc/apt/sources.list**. Редактировать файл будем при помощи текстового редактора **nano**

```{r eval=FALSE}
sudo nano /etc/apt/sources.list
```

Откроется содержимое файла. Спускаемся в самый низ и добавляем строчку

```{r eval=FALSE}
deb https://cran.rstudio.com/bin/linux/ubuntu xenial/
```

![](images/nano-list.png)

После этого нажимаем сочетание клавиш Ctrl+X для сохранения изменений. Нам предложат сохранить изменения - жмём **Y**

![](images/nano-save.png)

В последнем окне жмём **Enter** сохранения изменений в тот же файл.


### Добавление публичного ключа

Ключ используется для удостоверения подлинности и надежности репозитория. И добавляется с помощью следующей команды:

```{r eval=FALSE}
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 51716619E084DAB9
```

которая запрашивает ключ напрямую у сервера сертификации Ubuntu — keyserver.ubuntu.com

После чего обновляем кеш всех доступных пакетов

```{r eval=FALSE}
sudo apt update
```

*** 

## Установка R и R-Studio

### Установка R

Теперь можем установить необходимый нам пакет R с помощью  команды:

```{r eval=FALSE}
sudo apt-get install r-base -y
```

### Установка R-Studio

Помимо установки R, для удобства работы, нам нужно установить R Studio. И первым делом для этого нужно скачать установочный файл. Делаем это с помощью команды **wget**

```{r eval=FALSE}
wget https://download2.rstudio.org/rstudio-server-1.0.136-amd64.deb
```

Теперь, для того, чтобы провести установку R Studio, устанавливаем еще один пакет — gdebi. Gdebi — программа для установки .deb пакетов.

```{r eval=FALSE}
sudo apt-get install gdebi-core -y
```

И последней командой устанавливаем R Studio со скачанного файла:

```{r eval=FALSE}
sudo gdebi rstudio-server-1.0.136-amd64.deb
```

Теперь необходимо указать порт, при обращении к которому вы будете получать доступ в R Studio. Для этого нужно внести информацию в файл /etc/rstudio/rserver.conf. Делаем это с помощью команды

```{r eval=FALSE}
sudo nano /etc/rstudio/rserver.conf
```

и добавляем в файл следующую строку:

```{r eval=FALSE}
www-port=80
```

![](images/nano-port.png)

После этого задаем пароль для доступа в R Studio командой:

```{r eval=FALSE}
sudo passwd user_name
```

где, вместо **user_name** используем имя пользователя. При вводе пароля вам будет казаться, что ничего не происходит, но на самом деле введенные символы запоминаются. После второго успешного ввода вы увидите примерно следующее:

![](images/r-pass.png)

Осталось перезапустить серверный R-Studio и можно приступать к работе.

```{r eval=FALSE}
sudo service rstudio-server restart
```

*** 

## Запуск R-Studio

Чтобы попасть в привычный интерфейс R-Studio нужно перейти по внешнему адресу, указанному в интерфейсе Compute Engine в колонке **External_IP**

При переходе вы скорее всего увидете ошибку:

![](images/r-https.png)

Это происходит потому, что подключаемся мы по протоколу HTTPS через порт 443, а наш R-server работает через протокол HTTP через порт 8080.

Удалите букву **s** в URL

> https://22.222.222.22/ -> http://22.222.222.22/

И перед вами будет привычный интерфейс R-Studio с окошком для ввода логина и пароля.

![](images/r-enter.png)

Вводим логин/пароль и пользуемся R-Studio в облаке

***
## Дополнительные материалы
* [Запуск скриптов R по расписанию](http://baikulov.pro/r-cron.html)
* [Установка R-Studio через Docker](http://baikulov.pro/r-linux.html)
* [Установка R-Studio через Docker](http://baikulov.pro/r-docker.html)